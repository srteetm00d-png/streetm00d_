<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STREETMOOD ‚Äî Cat√°logo Premium</title>
    <link rel="icon" type="image/jpeg" href="streetm00d_.jpeg">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
<style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #121212;
            --accent-red: #ff2a2a;
            --accent-red-hover: #ff4040;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --glass: rgba(255, 255, 255, 0.04);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 42, 42, 0.1) 0%, rgba(255, 64, 64, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }
        
        .product-card:hover::before {
            opacity: 1;
        }
        
        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(255, 42, 42, 0.2), 0 0 30px rgba(255, 42, 42, 0.1);
        }
        
        .product-image {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .product-card:hover .product-image {
            transform: scale(1.1);
        }
        
        .drop-badge {
            background: linear-gradient(135deg, #ff2a2a 0%, #ff4040 100%);
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 42, 42, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 42, 42, 0.8); }
        }
        
        .modal-overlay {
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .tagline {
            font-size: 0.95rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-red-hover) 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.4);
        }
        
        .search-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent-red);
            box-shadow: 0 0 0 3px rgba(255, 42, 42, 0.1);
        }
        
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-red);
        }
        
</style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 z-40 glass-effect border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-[52px] h-[52px] rounded-[12px] flex items-center justify-center overflow-hidden" style="box-shadow: 0 0 12px rgba(255,42,42,0.3); margin: 10px 0 10px 10px;">
                        <img src="streetm00d_.jpeg" alt="STREETMOOD Logo" class="w-full h-full object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'font-black text-xl text-black\'>SM</span>';">
                    </div>
                    <div>
                        <h1 class="text-2xl font-black tracking-tight uppercase">STREETMOOD</h1>
                        <p class="tagline mt-1">Qualquer vibe, qualquer ocasi√£o.</p>
                    </div>
                </div>
                <button onclick="openWhatsApp()" class="btn-primary px-6 py-3 rounded-xl font-bold text-sm uppercase tracking-wide">
                    WhatsApp
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Page Title Section -->
        <div class="mb-8 text-center">
            <h2 class="text-xl md:text-2xl font-black mb-4 text-white leading-relaxed">
                Todos os produtos STREETMOOD ‚Äî Sneakers e roupas exclusivas que combinam com o teu estilo.
            </h2>
        </div>

        <!-- Tabs -->
        <div class="flex gap-4 mb-8 border-b border-white/10">
            <button onclick="switchTab('mais-vendido')" class="tab-button active px-6 py-3 font-bold text-sm uppercase tracking-wide text-white" data-tab="mais-vendido">
                üî• Mais Vendido
            </button>
            <button onclick="switchTab('sneakers')" class="tab-button px-6 py-3 font-bold text-sm uppercase tracking-wide text-gray-400" data-tab="sneakers">
                üëü Sneakers
            </button>
            <button onclick="switchTab('roupas')" class="tab-button px-6 py-3 font-bold text-sm uppercase tracking-wide text-gray-400" data-tab="roupas">
                üëï Roupas
            </button>
            </div>

        <!-- Filters -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="relative">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Pesquisar modelo..." 
                    class="search-input w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 focus:outline-none"
                    oninput="filterProducts()"
                >
            </div>
            <select id="categorySelect" onchange="filterProducts()" class="search-input w-full px-4 py-3 rounded-xl text-white focus:outline-none">
                <option value="all">Todas as categorias</option>
                <option value="stock">Em stock</option>
                <option value="drop">Fresh Drop</option>
            </select>
            <select id="sortSelect" onchange="filterProducts()" class="search-input w-full px-4 py-3 rounded-xl text-white focus:outline-none">
                <option value="all">Todos</option>
                <option value="new">Mais recentes</option>
                <option value="name">Ordenar por nome</option>
                <option value="price-asc">Pre√ßo: menor ‚Üí maior</option>
                <option value="price-desc">Pre√ßo: maior ‚Üí menor</option>
            </select>
        </div>

            <!-- Products Grid -->
        <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Products will be loaded here -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center items-center gap-2 mt-12 mb-8">
            <!-- Pagination buttons will be inserted here -->
            </div>

            <!-- Info Tags -->
        <div class="flex flex-wrap gap-3 mt-12 justify-center">
            <div class="glass-effect px-4 py-2 rounded-lg text-sm font-semibold">
                üöö Envio gr√°tis
            </div>
            <div class="glass-effect px-4 py-2 rounded-lg text-sm font-semibold">
                üì¶ Caixa STREETMOOD inclu√≠da
            </div>
            <div class="glass-effect px-4 py-2 rounded-lg text-sm font-semibold">
                +5‚Ç¨ por caixa original
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-16 py-8 border-t border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <p class="font-bold text-lg mb-2">STREETMOOD</p>
                    <p class="text-gray-400 text-sm">Fresh drops, encomendas e exclusividades.</p>
                    <p class="text-gray-500 text-xs mt-1">Envio gr√°tis üáµüáπ ‚Ä¢ Caixa STREETMOOD inclu√≠da (+5‚Ç¨ se quiser a original)</p>
                </div>
                <div class="flex gap-6 items-center">
                    <a href="https://instagram.com/streetm00d_" target="_blank" class="text-gray-400 hover:text-white transition-colors font-semibold">
                        Instagram
                    </a>
                    <span class="text-gray-500">‚Ä¢</span>
                    <a href="https://wa.me/351929461628" target="_blank" class="text-gray-400 hover:text-white transition-colors font-semibold">
                        WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <div id="productModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 modal-overlay">
        <div class="absolute inset-0 bg-black/80" onclick="closeModal()"></div>
        <div class="modal-content relative bg-gray-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto glass-effect border border-white/10">
            <div class="p-6">
                <!-- Modal Header -->
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="modalTitle" class="text-2xl font-black uppercase mb-2"></h2>
                        <div id="modalBadge" class="mb-2"></div>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl font-bold">&times;</button>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Image Viewer -->
                    <div id="modalViewer" class="bg-gray-800 rounded-xl overflow-hidden min-h-[350px] flex items-center justify-center">
                        <!-- Content will be inserted here -->
                </div>

                <!-- Product Details -->
                    <div>
                        <div class="mb-4">
                            <p id="modalPrice" class="text-3xl font-black text-red-500 mb-2"></p>
                            <p id="modalTag" class="text-gray-400 text-sm mb-4"></p>
                        </div>
                        
                        <p id="modalDescription" class="text-gray-300 mb-6 leading-relaxed"></p>
                        
                        <button 
                            id="reserveBtn" 
                            onclick="contactSeller()" 
                            class="btn-primary w-full py-4 rounded-xl font-bold text-lg uppercase tracking-wide mb-4"
                        >
                            üí¨ Comprar / DM
                        </button>
                        
                        <button 
                            onclick="reserveProduct()" 
                            class="glass-effect w-full py-4 rounded-xl font-bold text-lg uppercase tracking-wide mb-4 hover:bg-white/10 transition-colors"
                        >
                            üìå Reservar
                        </button>

                        <div class="glass-effect p-4 rounded-xl text-sm text-gray-300 space-y-2">
                        <p>‚úì Envio gr√°tis ‚Ä¢ Caixa STREETMOOD inclu√≠da</p>
                        <p>‚úì Caixa original dispon√≠vel (+5‚Ç¨)</p>
                        <p>‚úì Fotos antes do envio</p>
                        </div>
                        
                        <p class="text-center text-gray-500 text-sm mt-6 font-semibold">
                            STREETMOOD ‚Äî Qualquer vibe, qualquer ocasi√£o.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load products from streetmood_products.js -->
    <script src="streetmood_products.js"></script>
    <script>
        // Garantir que products est√° dispon√≠vel globalmente
        if (typeof products !== 'undefined') {
            window.products = products;
            console.log('‚úÖ Products carregados:', window.products.length);
        } else {
            console.error('‚ùå Products n√£o definido em streetmood_products.js');
            window.products = [];
        }

        // WhatsApp number oficial STREETMOOD
        const WHATSAPP_NUMBER = '351929461628';
        const INSTAGRAM_URL = 'https://instagram.com/streetm00d_';

        let currentProducts = window.products || [];
        let activeTab = 'mais-vendido';
        let currentProduct = null;
        let currentPage = 1;
        const productsPerPage = 20;

        // Initialize
        AOS.init({
            duration: 800,
            easing: 'ease-out-cubic',
            once: true
        });

        // Products now have images assigned directly in the products array
        // No need for hardcoded image list or mapping system
        // All images are loaded from imagens_produtos folder and assigned to products

        // Image path resolver for GitHub Pages compatibility
        // GitHub Pages is case-sensitive, so we need to normalize paths
        const imagePathResolver = {
            // Cache of resolved image paths
            cache: new Map(),
            
            // Normalize path for GitHub Pages (case-sensitive)
            normalizePath: function(path) {
                if (!path) return null;
                // Remove leading/trailing slashes and normalize
                let normalized = path.replace(/^\/+|\/+$/g, '');
                // Ensure imagens_produtos prefix
                if (!normalized.startsWith('imagens_produtos/')) {
                    normalized = 'imagens_produtos/' + normalized;
                }
                return normalized;
            },
            
            // Try to find image by product name (fallback when images not assigned)
            findImageByName: function(productName) {
                if (!productName) return null;
                
                // Normalize product name for matching
                let normalizedName = productName
                    .toLowerCase()
                    .replace(/['"]/g, '')
                    .replace(/[()]/g, '')
                    .replace(/\d{2}-\d{2}/g, '') // Remove sizes like 40-47
                    .replace(/\d{6,}[-\s]?\d{0,6}/g, '') // Remove codes
                    .replace(/\s+/g, ' ')
                    .trim();
                
                // Extract key words (remove common words)
                const commonWords = ['air', 'jordan', 'jordans', 'nike', 'retro', 'high', 'mid', 'low', 'og', 'gs'];
                const words = normalizedName.split(/\s+/).filter(w => 
                    w.length > 2 && !commonWords.includes(w.toLowerCase())
                );
                const keyName = words.join(' ') || normalizedName;
                
                // Generate multiple patterns to try
                const patterns = [];
                
                // Direct patterns
                patterns.push(keyName + '_1.jpg');
                patterns.push(keyName + '_1.jpeg');
                patterns.push(keyName + '_1.png');
                patterns.push(keyName + '.jpg');
                patterns.push(keyName + '.jpeg');
                patterns.push(keyName + '.png');
                
                // With underscores
                const underscored = keyName.replace(/\s+/g, '_');
                patterns.push(underscored + '_1.jpg');
                patterns.push(underscored + '_1.jpeg');
                patterns.push(underscored + '_1.png');
                
                // With original name variations
                patterns.push(normalizedName.replace(/\s+/g, '_') + '_1.jpg');
                patterns.push(normalizedName.replace(/\s+/g, ' ') + '_1.jpg');
                
                // Folder-based patterns (for subfolders)
                const folderPatterns = [
                    keyName + '/' + keyName + '_1.jpg',
                    keyName + '/' + keyName + '_1.jpeg',
                    underscored + '/' + underscored + '_1.jpg',
                    normalizedName + '/' + normalizedName + '_1.jpg',
                ];
                patterns.push(...folderPatterns);
                
                // Return first pattern (will be validated on load)
                // The actual validation happens in handleImageError
                return patterns.length > 0 ? this.normalizePath(patterns[0]) : null;
            },
            
            // Resolve image path with fallbacks for GitHub Pages
            resolvePath: function(imagePath) {
                if (!imagePath) return null;
                
                // Check cache first
                if (this.cache.has(imagePath)) {
                    return this.cache.get(imagePath);
                }
                
                // Normalize path
                let resolved = this.normalizePath(imagePath);
                
                // Try original path first
                const pathsToTry = [
                    resolved,
                    resolved.toLowerCase(),
                    resolved.replace(/\\/g, '/'),
                    resolved.replace(/\s+/g, '%20'), // URL encode spaces
                    resolved.replace(/\s+/g, '_'), // Replace spaces with underscores
                ];
                
                // Cache the first path (will be validated on load)
                this.cache.set(imagePath, pathsToTry[0]);
                return pathsToTry[0];
            }
        };
        
        // Get product images - products have images assigned directly in the products array
        function getProductImages(product) {
            // Product has images property with array of image paths
            if (product.images && Array.isArray(product.images) && product.images.length > 0) {
                // Resolve all image paths for GitHub Pages compatibility
                const resolved = product.images
                    .map(img => imagePathResolver.resolvePath(img))
                    .filter(img => img !== null);
                if (resolved.length > 0) {
                    return resolved;
                }
            }
            // Fallback to single image for backward compatibility
            if (product.image) {
                const resolved = imagePathResolver.resolvePath(product.image);
                if (resolved) {
                    return [resolved];
                }
            }
            
            // Last resort: try to find image by product name
            // This is important for products that don't have images assigned yet
            const foundImage = imagePathResolver.findImageByName(product.name);
            if (foundImage) {
                return [foundImage];
            }
            
            // Try with original name if different
            if (product.originalImageName) {
                const foundByOriginal = imagePathResolver.findImageByName(product.originalImageName);
                if (foundByOriginal) {
                    return [foundByOriginal];
                }
            }
            
            return [];
        }
        
        // Get first product image (for backward compatibility)
        function getProductImage(product) {
            const images = getProductImages(product);
            return images.length > 0 ? images[0] : null;
        }

        // Create placeholder HTML
        function createPlaceholderHTML(product) {
            const icon = (product && product.category === 'roupas') ? 'üëï' : 'üëü';
            return `
                <div class="flex flex-col items-center justify-center p-6 text-center h-full">
                    <div class="text-7xl mb-4 animate-pulse">${icon}</div>
                    <div class="text-2xl mb-2 font-black text-red-500 uppercase">STREETMOOD</div>
                    <div class="text-gray-400 text-sm mb-2">Sem foto dispon√≠vel ‚Äî em breve.</div>
                    <div class="text-gray-500 text-xs max-w-xs">Em breve ter√°s acesso<br>√† visualiza√ß√£o completa deste modelo</div>
                </div>
            `;
        }

        // Format product name - remove codes and format size
        function formatProductName(product) {
            let name = product.name;
            // Remove product codes (like 555088-134, CD4487-100, etc.)
            name = name.replace(/\s+\d{6,}[-\s]?\d{0,6}/g, '');
            // Remove codes at the end (like "555088-134")
            name = name.replace(/\s+\d{6,}-\d{3,}/g, '');
            // Clean up multiple spaces
            name = name.replace(/\s+/g, ' ').trim();
            return name;
        }
        
        // Format size display
        function formatSize(size) {
            if (!size) return '';
            // Convert "36-40" to "tamanhos do 36 ao 40"
            const match = size.match(/(\d+)-(\d+)/);
            if (match) {
                return `tamanhos do ${match[1]} ao ${match[2]}`;
            }
            return size;
        }
        
        // Function to try alternative image paths when one fails
        function tryAlternativeImagePaths(originalPath, productName) {
            if (!originalPath) return [];
            
            const alternatives = [];
            const basePath = originalPath.replace(/[^\/]*$/, ''); // Get directory
            const fileName = originalPath.split('/').pop(); // Get filename
            const nameWithoutExt = fileName.replace(/\.(jpg|jpeg|png)$/i, '');
            const ext = fileName.match(/\.(jpg|jpeg|png)$/i)?.[1] || 'jpg';
            
            // Try different variations
            alternatives.push(originalPath.toLowerCase());
            alternatives.push(originalPath.replace(/\s+/g, '%20'));
            alternatives.push(originalPath.replace(/\s+/g, '_'));
            alternatives.push(basePath + nameWithoutExt.toLowerCase() + '.' + ext);
            alternatives.push(basePath + nameWithoutExt.replace(/\s+/g, '_') + '.' + ext);
            alternatives.push(basePath + nameWithoutExt.replace(/\s+/g, '%20') + '.' + ext);
            
            // Try with product name
            const normalizedProductName = productName
                .toLowerCase()
                .replace(/['"]/g, '')
                .replace(/[()]/g, '')
                .replace(/\d{2}-\d{2}/g, '')
                .replace(/\d{6,}[-\s]?\d{0,6}/g, '')
                .replace(/\s+/g, '_')
                .trim();
            
            if (normalizedProductName) {
                alternatives.push(`imagens_produtos/${normalizedProductName}_1.jpg`);
                alternatives.push(`imagens_produtos/${normalizedProductName}_1.jpeg`);
                alternatives.push(`imagens_produtos/${normalizedProductName}_1.png`);
                alternatives.push(`imagens_produtos/${normalizedProductName}.jpg`);
            }
            
            return [...new Set(alternatives)]; // Remove duplicates
        }
        
        // Global image error handler - tries alternative paths
        window.handleImageError = function(imgElement, productName, productId) {
            const originalSrc = imgElement.getAttribute('data-original-src') || imgElement.src;
            const alternatives = tryAlternativeImagePaths(originalSrc, productName);
            let currentIndex = 0;
            
            // Show loading placeholder
            const container = imgElement.closest('.relative');
            if (container) {
                const placeholder = container.querySelector('.error-placeholder');
                if (placeholder) {
                    placeholder.classList.remove('hidden');
                    placeholder.querySelector('.text-xs').textContent = 'Tentando carregar imagem...';
                }
            }
            
            function tryNextAlternative() {
                if (currentIndex >= alternatives.length) {
                    // All alternatives failed
                    if (container) {
                        const placeholder = container.querySelector('.error-placeholder');
                        if (placeholder) {
                            placeholder.querySelector('.text-xs').textContent = 'Imagem n√£o encontrada';
                        }
                    }
                    imgElement.style.display = 'none';
                    return;
                }
                
                const currentPath = alternatives[currentIndex];
                const testImg = new Image();
                
                testImg.onload = function() {
                    // Found working path!
                    imgElement.src = currentPath;
                    imgElement.style.display = '';
                    if (container) {
                        const placeholder = container.querySelector('.error-placeholder');
                        if (placeholder) {
                            placeholder.classList.add('hidden');
                        }
                    }
                    // Update cache
                    imagePathResolver.cache.set(originalSrc, currentPath);
                };
                
                testImg.onerror = function() {
                    currentIndex++;
                    tryNextAlternative();
                };
                
                testImg.src = currentPath;
            }
            
            // Hide original image and try alternatives
            imgElement.style.display = 'none';
            tryNextAlternative();
        };
        
        // Render product card
        function renderProductCard(product) {
            const images = getProductImages(product);
            const image = images.length > 0 ? images[0] : null;
            // Todos os produtos est√£o dispon√≠veis no STREETMOOD - sem badges de tipo
            const badge = '';
            
            // Always render products - even if image path is not found yet
            // The image error handler will try to find alternatives
            const hasImage = image !== null && image !== undefined && image !== '';
            
            // If no image found, try to find one by name
            let finalImage = image;
            if (!hasImage) {
                const foundImage = imagePathResolver.findImageByName(product.name);
                finalImage = foundImage;
            }
            
            const formattedName = formatProductName(product);
            const formattedSize = formatSize(product.size);
            const productId = product.id;
            
            let imageHTML = '';
            // Always show image container - even if image path is not found
            // The error handler will try alternatives
            if (finalImage || hasImage) {
                const imageToUse = finalImage || image;
                // Create unique ID for image container
                const imageContainerId = `img-container-${productId}`;
                
                // If multiple images, show first image with indicator
                if (images.length > 1) {
                    imageHTML = `<div class="relative w-full h-full" id="${imageContainerId}">
                                    <img src="${imageToUse}" 
                                         alt="${formattedName}" 
                                         class="product-image w-full h-full object-contain"
                                         data-product-id="${productId}"
                                         data-original-src="${imageToUse}"
                                         onerror="handleImageError(this, '${formattedName.replace(/'/g, "\\'")}', ${productId})">
                                    <div class="absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-full font-semibold">
                                        ${images.length} fotos
                                    </div>
                                    <div class="hidden absolute inset-0 flex flex-col items-center justify-center p-4 text-center bg-gray-800 rounded-xl error-placeholder">
                                        <div class="text-5xl mb-2 animate-pulse">${product.category === 'roupas' ? 'üëï' : 'üëü'}</div>
                                        <div class="text-xs text-gray-400">Carregando imagem...</div>
                                    </div>
                                </div>`;
                } else {
                    imageHTML = `<div class="relative w-full h-full" id="${imageContainerId}">
                                    <img src="${imageToUse}" 
                                         alt="${formattedName}" 
                                         class="product-image w-full h-full object-contain"
                                         data-product-id="${productId}"
                                         data-original-src="${imageToUse}"
                                         onerror="handleImageError(this, '${formattedName.replace(/'/g, "\\'")}', ${productId})">
                                    <div class="hidden absolute inset-0 flex flex-col items-center justify-center p-4 text-center bg-gray-800 rounded-xl error-placeholder">
                                        <div class="text-5xl mb-2 animate-pulse">${product.category === 'roupas' ? 'üëï' : 'üëü'}</div>
                                        <div class="text-xs text-gray-400">Carregando imagem...</div>
                                    </div>
                                </div>`;
                }
            } else {
                // No image found yet - show placeholder but still render product
                imageHTML = `<div class="relative w-full h-full" id="${imageContainerId}">
                                <div class="absolute inset-0 flex flex-col items-center justify-center p-4 text-center bg-gray-800 rounded-xl">
                                    <div class="text-5xl mb-2 animate-pulse">${product.category === 'roupas' ? 'üëï' : 'üëü'}</div>
                                    <div class="text-xs text-gray-400">Procurando imagem...</div>
                                </div>
                            </div>`;
            }
            
            return `
                <div class="product-card glass-effect rounded-2xl p-4 cursor-pointer" 
                     onclick="openModal(${product.id})"
                     data-aos="fade-up"
                     data-name="${product.name.toLowerCase()}"
                     data-price="${product.price_eur}"
                     data-type="${product.tipo}">
                    <div class="relative mb-4 bg-gray-800 rounded-xl overflow-hidden h-48 flex items-center justify-center">
                        ${imageHTML}
                    </div>
                    <div class="space-y-2">
                        <h3 class="font-bold text-sm uppercase leading-tight line-clamp-2">${formattedName}</h3>
                        ${formattedSize ? `<p class="text-gray-400 text-xs">${formattedSize}</p>` : ''}
                        <div class="flex justify-between items-center">
                            <p class="text-red-500 font-black text-lg">${product.price_eur !== null && product.price_eur !== undefined ? product.price_eur + '‚Ç¨' : (product.price || '‚Äî')}</p>
                        </div>
                        <button class="w-full mt-2 py-2 glass-effect rounded-lg text-sm font-semibold hover:bg-white/10 transition-colors">
                            Ver mais
                        </button>
                    </div>
                </div>
            `;
        }

        // Render products grid with pagination
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            if (currentProducts.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-400">Nenhum produto encontrado.</div>';
                renderPagination();
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(currentProducts.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsToShow = currentProducts.slice(startIndex, endIndex);
            
            grid.innerHTML = productsToShow.map(renderProductCard).join('');
            AOS.refresh();
            
            // Render pagination
            renderPagination(totalPages);
        }

        // Render pagination buttons
        function renderPagination(totalPages = 1) {
            const paginationDiv = document.getElementById('pagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button onclick="goToPage(${currentPage - 1})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                        ‚Üê Anterior
                    </button>
                `;
            }
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                paginationHTML += `<button onclick="goToPage(1)" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2 text-gray-500">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === currentPage) {
                    paginationHTML += `
                        <button class="btn-primary px-4 py-2 rounded-lg font-semibold">
                            ${i}
                        </button>
                    `;
                } else {
                    paginationHTML += `
                        <button onclick="goToPage(${i})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                            ${i}
                        </button>
                    `;
                }
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2 text-gray-500">...</span>`;
                }
                paginationHTML += `<button onclick="goToPage(${totalPages})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">${totalPages}</button>`;
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button onclick="goToPage(${currentPage + 1})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                        Pr√≥xima ‚Üí
                    </button>
                `;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }

        // Go to specific page
        function goToPage(page) {
            currentPage = page;
            renderProducts();
            // Scroll to top of products grid
            document.getElementById('productsGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Filter products - Todos os produtos est√£o dispon√≠veis no STREETMOOD
        function filterProducts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sort = document.getElementById('sortSelect').value;
            const category = document.getElementById('categorySelect').value;
            
            let filtered = window.products || [];
            
            // Tab filter - filter by tab type
            if (activeTab === 'mais-vendido') {
                // Show only best sellers
                filtered = filtered.filter(p => p.isBestSeller === true);
            } else if (activeTab === 'sneakers') {
                // Show only sneakers (category !== "roupas" or no category field)
                filtered = filtered.filter(p => !p.category || p.category !== 'roupas');
            } else if (activeTab === 'roupas') {
                // Show only clothing (category === "roupas")
                filtered = filtered.filter(p => p.category === 'roupas');
            }
            
            // Category filter (stock/drop) - applies within the current tab
            if (category === 'stock') {
                filtered = filtered.filter(p => p.tipo === 'stock');
            } else if (category === 'drop') {
                filtered = filtered.filter(p => p.tipo === 'drop');
            }
            // If category === 'all', show all products in current tab
            
            // Search filter
            if (search) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(search) ||
                    (p.size && p.size.toLowerCase().includes(search)) ||
                    (p.tipo && p.tipo.toLowerCase().includes(search)) ||
                    (p.isUnidentified && 'n√£o identificado'.includes(search))
                );
            }
            
            // Sort products
            filtered.sort((a, b) => {
                // Apply selected sorting
                if (sort === 'price-asc') {
                    // Products without price go to end
                    if (a.price_eur === null || a.price_eur === undefined) return 1;
                    if (b.price_eur === null || b.price_eur === undefined) return -1;
                    return (a.price_eur || 0) - (b.price_eur || 0);
                } else if (sort === 'price-desc') {
                    // Products without price go to end
                    if (a.price_eur === null || a.price_eur === undefined) return 1;
                    if (b.price_eur === null || b.price_eur === undefined) return -1;
                    return (b.price_eur || 0) - (a.price_eur || 0);
                } else if (sort === 'name') {
                    return (a.name || '').localeCompare(b.name || '');
                } else {
                    // Mais recentes (por ID, maior ID = mais recente) - default for "all" and "new"
                    return (b.id || 0) - (a.id || 0);
                }
            });
            
            // Don't filter out products without images - let them render
            // The image error handler and auto-discovery will try to find images
            // This ensures all products are shown, even if images aren't found yet
            
            currentProducts = filtered;
            currentPage = 1; // Reset to first page when filtering
            renderProducts();
        }

        // Switch tab
        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                btn.classList.add('text-gray-400');
            });
            const activeBtn = document.querySelector(`[data-tab="${tab}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'text-white');
                activeBtn.classList.remove('text-gray-400');
            }
            // Reset to first page when switching tabs
            currentPage = 1;
            filterProducts();
        }

        // Open modal
        function openModal(productId) {
            const products = window.products || [];
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentProduct = product;
            const modal = document.getElementById('productModal');
            const images = getProductImages(product);
            
            // Format product name and size for modal
            const formattedName = formatProductName(product);
            const formattedSize = formatSize(product.size);
            const modalTitle = formattedName + (formattedSize ? `, ${formattedSize}` : '');
            
            // Set modal content
            document.getElementById('modalTitle').textContent = modalTitle;
            const priceDisplay = product.price_eur !== null && product.price_eur !== undefined 
                ? `${product.price_eur}‚Ç¨` 
                : (product.price || '‚Äî');
            document.getElementById('modalPrice').textContent = priceDisplay;
            document.getElementById('modalTag').textContent = product.isUnidentified ? 'Produto n√£o identificado' : 'Dispon√≠vel no STREETMOOD';
            document.getElementById('modalDescription').textContent = product.desc || 
                `Produto premium importado. Envio gr√°tis. Caixa STREETMOOD inclu√≠da. Caixa original dispon√≠vel (+5‚Ç¨).`;
            
            // Todos os produtos est√£o dispon√≠veis - sem badge de tipo
            document.getElementById('modalBadge').innerHTML = '';
            
            // Set viewer with placeholder if no image
            const viewer = document.getElementById('modalViewer');
            viewer.innerHTML = '';
            
            // Check if images exist or use placeholder
            if (images.length > 0) {
                if (images.length === 1) {
                    // Single image with retry logic
                    const img = new Image();
                    const alternatives = tryAlternativeImagePaths(images[0], formattedName);
                    let currentIndex = 0;
                    
                    function tryNextModalImage() {
                        if (currentIndex >= alternatives.length) {
                            // All failed, show placeholder
                            viewer.innerHTML = createPlaceholderHTML(product);
                            return;
                        }
                        
                        const currentPath = alternatives[currentIndex];
                        img.onload = function() {
                            viewer.innerHTML = `
                                <img src="${currentPath}" 
                                     alt="${formattedName}" 
                                     class="max-w-full max-h-full object-contain rounded-xl"
                                     onerror="this.src=''; this.parentElement.innerHTML='${createPlaceholderHTML(product).replace(/'/g, "\\'")}'">
                            `;
                            // Update cache
                            imagePathResolver.cache.set(images[0], currentPath);
                        };
                        img.onerror = function() {
                            currentIndex++;
                            tryNextModalImage();
                        };
                        img.src = currentPath;
                    }
                    
                    tryNextModalImage();
                } else {
                    // Multiple images - create carousel
                    let carouselHTML = `
                        <div class="relative w-full h-full">
                            <div id="imageCarousel" class="relative w-full h-full overflow-hidden rounded-xl">
                                ${images.map((img, index) => `
                                    <div class="carousel-slide ${index === 0 ? 'active' : 'hidden'} absolute inset-0 flex items-center justify-center">
                                        <img src="${img}" 
                                             alt="${formattedName} - Foto ${index + 1}" 
                                             class="max-w-full max-h-full object-contain rounded-xl"
                                             onerror="this.parentElement.style.display='none'">
                                    </div>
                                `).join('')}
                            </div>
                            ${images.length > 1 ? `
                                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2">
                                    ${images.map((_, index) => `
                                        <button onclick="showCarouselImage(${index})" 
                                                class="carousel-dot ${index === 0 ? 'active' : ''} w-2 h-2 rounded-full bg-white/60 hover:bg-white transition-colors"></button>
                                    `).join('')}
                                </div>
                                ${images.length > 1 ? `
                                    <button onclick="previousCarouselImage()" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/60 text-white p-2 rounded-full hover:bg-black/80 transition-colors">
                                        ‚Üê
                                    </button>
                                    <button onclick="nextCarouselImage()" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/60 text-white p-2 rounded-full hover:bg-black/80 transition-colors">
                                        ‚Üí
                                    </button>
                                ` : ''}
                            ` : ''}
                        </div>
                    `;
                    viewer.innerHTML = carouselHTML;
                    
                    // Store current image index
                    window.currentCarouselIndex = 0;
                    window.currentCarouselImages = images;
                }
            } else {
                // If no images, close modal (product shouldn't be shown anyway)
                closeModal();
                return;
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }
        
        // Carousel functions
        function showCarouselImage(index) {
            const slides = document.querySelectorAll('.carousel-slide');
            const dots = document.querySelectorAll('.carousel-dot');
            
            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.remove('hidden');
                    slide.classList.add('active');
                } else {
                    slide.classList.add('hidden');
                    slide.classList.remove('active');
                }
            });
            
            dots.forEach((dot, i) => {
                if (i === index) {
                    dot.classList.add('active');
                    dot.classList.remove('bg-white/60');
                    dot.classList.add('bg-white');
                } else {
                    dot.classList.remove('active');
                    dot.classList.add('bg-white/60');
                    dot.classList.remove('bg-white');
                }
            });
            
            window.currentCarouselIndex = index;
        }
        
        function nextCarouselImage() {
            if (!window.currentCarouselImages || window.currentCarouselImages.length === 0) return;
            const nextIndex = (window.currentCarouselIndex + 1) % window.currentCarouselImages.length;
            showCarouselImage(nextIndex);
        }
        
        function previousCarouselImage() {
            if (!window.currentCarouselImages || window.currentCarouselImages.length === 0) return;
            const prevIndex = (window.currentCarouselIndex - 1 + window.currentCarouselImages.length) % window.currentCarouselImages.length;
            showCarouselImage(prevIndex);
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('productModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';
        }

        // Contact seller (Buy/DM button)
        function contactSeller() {
            if (!currentProduct) return;
            
            const name = currentProduct.name;
            const size = currentProduct.size || '';
            const productType = currentProduct.isUnidentified ? 'produto n√£o identificado' : 'produto';
            const msg = encodeURIComponent(`Ol√° STREETMOOD üëü quero comprar o ${name}${size ? ' (T:' + size + ')' : ''} ainda est√° dispon√≠vel?`);
            window.open(`https://wa.me/351929461628?text=${msg}`, '_blank');
        }

        // Reserve product
        function reserveProduct() {
            if (!currentProduct) return;
            
            const name = currentProduct.name;
            const msg = encodeURIComponent(`Ol√° STREETMOOD üëü quero reservar o ${name}. Podes enviar fotos reais antes do envio?`);
            window.open(`https://wa.me/351929461628?text=${msg}`, '_blank');
        }

        // Open WhatsApp (header button)
        function openWhatsApp() {
            const msg = encodeURIComponent('Ol√° STREETMOOD! Quero saber mais sobre os vossos produtos.');
            window.open(`https://wa.me/351929461628?text=${msg}`, '_blank');
        }

        // Close modal on ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Products already have images assigned from the products file
        // No need for image assignment functions

        // Function to auto-discover images for products without images
        async function autoDiscoverImages() {
            if (!window.products || window.products.length === 0) return;
            
            console.log('üîç Procurando imagens para produtos sem imagens definidas...');
            let foundCount = 0;
            
            for (const product of window.products) {
                // Skip if product already has images
                if (product.images && Array.isArray(product.images) && product.images.length > 0) {
                    continue;
                }
                if (product.image) {
                    continue;
                }
                
                // Try to find image by name
                const foundImage = imagePathResolver.findImageByName(product.name);
                if (foundImage) {
                    // Test if image actually exists
                    const testImg = new Image();
                    await new Promise((resolve) => {
                        testImg.onload = function() {
                            // Image exists! Assign it
                            if (!product.images) {
                                product.images = [];
                            }
                            product.images.push(foundImage);
                            product.image = foundImage;
                            foundCount++;
                            resolve();
                        };
                        testImg.onerror = function() {
                            resolve();
                        };
                        testImg.src = foundImage;
                    });
                }
            }
            
            if (foundCount > 0) {
                console.log(`‚úÖ Encontradas ${foundCount} imagens automaticamente`);
                // Re-render products to show newly found images
                filterProducts();
            }
        }
        
        // Initialize
        async function init() {
            // Wait a bit to ensure products are loaded
            if (!window.products || window.products.length === 0) {
                console.warn('‚ö†Ô∏è Aguardando carregamento de produtos...');
                let attempts = 0;
                while ((!window.products || window.products.length === 0) && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
            }
            
            if (window.products && window.products.length > 0) {
                console.log('‚úÖ Produtos carregados:', window.products.length);
                
                // Remove duplicates - keep only first occurrence of each product name
                const seenNames = new Set();
                const uniqueProducts = [];
                for (const product of window.products) {
                    const normalizedName = product.name.toLowerCase().trim();
                    if (!seenNames.has(normalizedName)) {
                        seenNames.add(normalizedName);
                        uniqueProducts.push(product);
                    }
                }
                
                // Don't limit products - show all products to ensure all images appear
                window.products = uniqueProducts;
                
                const sneakers = window.products.filter(p => !p.category || p.category !== 'roupas');
                const roupas = window.products.filter(p => p.category === 'roupas');
                console.log(`‚úÖ ${window.products.length} produtos √∫nicos (${sneakers.length} sneakers, ${roupas.length} roupas)`);
                
                // Don't filter out products without images - let them render and try to find images
                // The auto-discovery will find images for products that don't have them
                
                // Sort products: by ID (most recent first)
                window.products.sort((a, b) => {
                    return (b.id || 0) - (a.id || 0);
                });
                
                currentProducts = window.products;
                currentPage = 1;
                renderProducts();
                
                // Try to auto-discover images for products without images (in background)
                setTimeout(() => {
                    autoDiscoverImages();
                }, 1000);
            } else {
                console.error('‚ùå Nenhum produto foi carregado!');
                document.getElementById('productsGrid').innerHTML = '<div class="col-span-full text-center py-12 text-gray-400">Erro ao carregar produtos. Por favor, recarrega a p√°gina.</div>';
            }
        }

        // Start initialization
        init();
    </script>
</body>
</html>
