<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STREETMOOD ‚Äî Cat√°logo Premium</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
<style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #121212;
            --accent-red: #e50914;
            --accent-red-hover: #ff1e1e;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --glass: rgba(255, 255, 255, 0.04);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.1) 0%, rgba(255, 30, 30, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }
        
        .product-card:hover::before {
            opacity: 1;
        }
        
        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(229, 9, 20, 0.2), 0 0 30px rgba(229, 9, 20, 0.1);
        }
        
        .product-image {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .product-card:hover .product-image {
            transform: scale(1.1);
        }
        
        .drop-badge {
            background: linear-gradient(135deg, #e50914 0%, #ff1e1e 100%);
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(229, 9, 20, 0.5); }
            50% { box-shadow: 0 0 20px rgba(229, 9, 20, 0.8); }
        }
        
        .modal-overlay {
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .tagline {
            font-size: 0.95rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-red-hover) 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.4);
        }
        
        .search-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent-red);
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.1);
        }
        
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-red);
        }
        
</style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 z-40 glass-effect border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-red-600 to-red-500 rounded-xl flex items-center justify-center overflow-hidden shadow-lg">
                        <img src="assets/images/logo.png" alt="STREETMOOD Logo" class="w-full h-full object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'font-black text-xl text-black\'>SM</span>';">
                    </div>
                    <div>
                        <h1 class="text-2xl font-black tracking-tight uppercase">STREETMOOD</h1>
                        <p class="tagline mt-1">Qualquer vibe, qualquer ocasi√£o.</p>
                    </div>
                </div>
                <button onclick="openWhatsApp()" class="btn-primary px-6 py-3 rounded-xl font-bold text-sm uppercase tracking-wide">
                    WhatsApp
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Page Title Section -->
        <div class="mb-8 text-center">
            <h2 class="text-xl md:text-2xl font-black mb-4 text-white leading-relaxed">
                üì¶ Esta √© a p√°gina onde encontras todos os sneakers dispon√≠veis na <span class="text-red-500">STREETMOOD</span>.
            </h2>
        </div>

        <!-- Tabs -->
        <div class="flex gap-4 mb-8 border-b border-white/10">
            <button onclick="switchTab('all')" class="tab-button active px-6 py-3 font-bold text-sm uppercase tracking-wide text-white" data-tab="all">
                Cat√°logo Completo
            </button>
            </div>

        <!-- Filters -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="relative">
                    <input 
                        type="text" 
                    id="searchInput" 
                    placeholder="Pesquisar modelo..." 
                    class="search-input w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 focus:outline-none"
                    oninput="filterProducts()"
                    >
                </div>
            <select id="sortSelect" onchange="filterProducts()" class="search-input w-full px-4 py-3 rounded-xl text-white focus:outline-none">
                <option value="all">Todos (com imagem primeiro)</option>
                <option value="new">Mais recentes</option>
                <option value="name">Ordenar por nome</option>
                <option value="price-asc">Pre√ßo: menor ‚Üí maior</option>
                <option value="price-desc">Pre√ßo: maior ‚Üí menor</option>
            </select>
            </div>

            <!-- Products Grid -->
        <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Products will be loaded here -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center items-center gap-2 mt-12 mb-8">
            <!-- Pagination buttons will be inserted here -->
            </div>

            <!-- Info Tags -->
        <div class="flex flex-wrap gap-3 mt-12 justify-center">
            <div class="glass-effect px-4 py-2 rounded-lg text-sm font-semibold">
                üöö Envio gr√°tis
            </div>
            <div class="glass-effect px-4 py-2 rounded-lg text-sm font-semibold">
                üì¶ Caixa STREETMOOD inclu√≠da
            </div>
            <div class="glass-effect px-4 py-2 rounded-lg text-sm font-semibold">
                +5‚Ç¨ por caixa original
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-16 py-8 border-t border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <p class="font-bold text-lg mb-2">STREETMOOD</p>
                    <p class="text-gray-400 text-sm">Vibes, drops e amor ao estilo.</p>
                </div>
                <div class="flex gap-6 items-center">
                    <a href="https://instagram.com/streetm00d_" target="_blank" class="text-gray-400 hover:text-white transition-colors font-semibold">
                        @streetm00d_
                    </a>
                    <span class="text-gray-500">‚Ä¢</span>
                    <a href="https://wa.me/351929461628" target="_blank" class="text-gray-400 hover:text-white transition-colors font-semibold">
                        WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <div id="productModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 modal-overlay">
        <div class="absolute inset-0 bg-black/80" onclick="closeModal()"></div>
        <div class="modal-content relative bg-gray-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto glass-effect border border-white/10">
            <div class="p-6">
                <!-- Modal Header -->
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="modalTitle" class="text-2xl font-black uppercase mb-2"></h2>
                        <div id="modalBadge" class="mb-2"></div>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl font-bold">&times;</button>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Image Viewer -->
                    <div id="modalViewer" class="bg-gray-800 rounded-xl overflow-hidden min-h-[350px] flex items-center justify-center">
                        <!-- Content will be inserted here -->
                </div>

                <!-- Product Details -->
                    <div>
                        <div class="mb-4">
                            <p id="modalPrice" class="text-3xl font-black text-red-500 mb-2"></p>
                            <p id="modalTag" class="text-gray-400 text-sm mb-4"></p>
                        </div>
                        
                        <p id="modalDescription" class="text-gray-300 mb-6 leading-relaxed"></p>
                        
                        <button 
                            id="reserveBtn" 
                            onclick="contactSeller()" 
                            class="btn-primary w-full py-4 rounded-xl font-bold text-lg uppercase tracking-wide mb-4"
                        >
                            üí¨ Comprar via WhatsApp
                        </button>
                        
                        <button 
                            onclick="reserveProduct()" 
                            class="glass-effect w-full py-4 rounded-xl font-bold text-lg uppercase tracking-wide mb-4 hover:bg-white/10 transition-colors"
                        >
                            üìå Reservar
                        </button>

                        <div class="glass-effect p-4 rounded-xl text-sm text-gray-300 space-y-2">
                        <p>‚úì Envio gr√°tis ‚Ä¢ Caixa STREETMOOD inclu√≠da</p>
                        <p>‚úì Caixa original dispon√≠vel (+5‚Ç¨)</p>
                        <p>‚úì Fotos antes do envio</p>
                        </div>
                        
                        <p class="text-center text-gray-500 text-sm mt-6 font-semibold">
                            STREETMOOD ‚Äî Qualquer vibe, qualquer ocasi√£o.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load products from streetmood_products.js -->
    <script src="streetmood_products.js"></script>
    <script>
        // Garantir que products est√° dispon√≠vel globalmente
        if (typeof products !== 'undefined') {
            window.products = products;
            console.log('‚úÖ Products carregados:', window.products.length);
        } else {
            console.error('‚ùå Products n√£o definido em streetmood_products.js');
            window.products = [];
        }

        // WhatsApp number oficial STREETMOOD
        const WHATSAPP_NUMBER = '351929461628';
        const INSTAGRAM_URL = 'https://instagram.com/streetm00d_';

        let currentProducts = window.products || [];
        let activeTab = 'all';
        let currentProduct = null;
        let currentPage = 1;
        const productsPerPage = 20;

        // Initialize
        AOS.init({
            duration: 800,
            easing: 'ease-out-cubic',
            once: true
        });

        // Available images from imagens_produtos folder
        const availableImages = [
            "Air Jordan 312_1.jpg",
            "Air Jordan 4 Retro_1.jpg",
            "Air Jordans 1 CD4487-100_1.jpg",
            "Air Jordans 1 High University Blue 555088-134_1.jpg",
            "AIR JORDANS 1 HIGH ZOOM \"Racer Blue\" CK6637-104_1.jpg",
            "AIR JORDANS 1 LOW \"Mystic Green\"553558-113_1.jpg",
            "Air Jordans 1 Mid (GS)555112-500_1.jpg",
            "Air Jordans 1 Mid GS \"Light Smoke Grey\"554724-092_1.jpg",
            "Air Jordans 1 Mid SE 852542-400_1.jpg",
            "Air Jordans 1 MID SE \"South Beach\"852542-306_1.jpg",
            "Air Jordans 1 Mid 'Candy' 554725-083_1.jpg",
            "Air Jordans 1 Mid \"Black Cone\" 554724-062_1.jpg",
            "Air Jordans 1 Mid \"Chicago Black Toe\" 554724-069_1.jpg",
            "Air Jordans 1 Mid \"Lakers Top 3\"852542-005_1.jpg",
            "Air Jordans 1 Mid \"Multicolor\" 554724-125_1.jpg",
            "Air Jordans 1 MID \"Top 3\" 554724-124_1.jpg",
            "Air Jordans 1 Retro High CN8607-002_1.jpg",
            "Air Jordans 1 Retro High Co.JP 'Midnight Navy' DC1788-100_1.jpg",
            "Air Jordans 1 Retro High OG GS \"Crimson Tint\" 555088-081_1.jpg",
            "Air Jordans 11 Retro 'Gamma Blue' 378038-006_1.jpg",
            "Air Jordans 3 Retro 'Red Cement' CT8532-104_1.jpg",
            "Air Jordans 3 'Lazer Orange' CK9246-108_1.jpg",
            "Air Jordans 4 Bred 408452-060_1.jpg",
            "Air Jordans 4 Retro SP 'Union ‚Äì Guava Ice DC9533-009_1.jpg",
            "Air Jordans 4 Retro 'University Blue' CT8527-400_1.jpg",
            "Air Jordans 4 Retro \"White Oreo\" CT8527-100_1.jpg",
            "Air Jordans 4 Retro_1.jpg",
            "Air Jordans 4 'Black Cat' CU1110-010_1.jpg",
            "Air Jordans 4 'Fire Red' DC7770-160_1.jpg",
            "Air Jordans 4 'Off Noir' DC9533-001_1.jpg",
            "Air Jordans 4 'PSG' CZ6509-100_1.jpg",
            "Air Jordans 4 'Pure Money' 308497-100_1.jpg",
            "Jordan 13 Retro Black White Gum_1.jpg",
            "Jordan 13 Retro Brave Blue_1.jpg",
            "Jordan 13 Retro French Blue_1.jpg",
            "Jordan 4 Retro Cool Grey (2019)_1.jpg",
            "Jordan 4 Retro Flight Nostalgia_1.jpg",
            "Jordan 4 Retro Lightning (2021)_1.jpg",
            "Jordan 4 Retro Metallic Green_1.jpg",
            "Jordan 4 Retro Metallic Red_1.jpg",
            "Jordan 4 Retro Motorsports (2017)_1.jpg",
            "Jordan 4 Retro SE 95 Neon_1.jpg",
            "Jordan 4 Retro Thunder (2012)_1.jpg",
            "Jordan Air Jordan 3 Barely Grape Pink Purple_1.jpg",
            "Jordan Air Jordan 3 Retro Black Gold Black gold_1.jpg",
            "Jordan Air Jordan 3 retro true blue White Blue_1.jpg",
            "Jordan Air Jordan 3 tinker black and white_1.jpg",
            "Jordans 1 Mid White Black Light Arctic Pink 555112-103_1.jpg",
            "Jordans 1 Retro High \"Homage To Home\" 555088-001_1.jpg",
            "Nike ACG Mountain Fly 2 Black_1.jpg",
            "Nike ACG Mountain Fly 2 Gerry_1.jpg",
            "Nike ACG Mountain Fly 2_1.jpg",
            "Nike Air Jordan 5_1.jpg",
            "Nike Air Jordan 6 Retro Black Infrared_1.jpg",
            "Nike Air Jordan 6 Retro Carmine (2014)_1.jpg",
            "Nike Air Jordan 6 Retro Chrome Metallic Silver_1.jpg",
            "Nike Air Jordan 6 Retro DMP 2020 (GS)_1.jpg",
            "Nike Air Jordan 6 Retro Midnight Navy (2000)_1.jpg",
            "Nike Air Jordan 6 Retro UNC_1.jpg",
            "Nike Jordan Stadium 90 Gris_1.jpg",
            "Nike Jordan Stadium 90 White Amarillo de hoja caduca_1.jpg",
            "Nike Jordan Stadium 90 White black_1.jpg",
            "Nike Jordan Stadium 90 White Morado_1.jpg",
            "Nike Jordan Stadium 90 White pink_1.jpg",
            "Nike Jordan Stadium 90 White red_1.jpg"
        ];

        // Image mapping system
        const imageMap = {
            // Normalize function to clean names for matching
            normalize: function(name) {
                return name
                    .toLowerCase()
                    .replace(/['"]/g, '')
                    .replace(/[()]/g, '')
                    .replace(/\d{1,2}-\d{1,2}/g, '') // Remove size ranges like "40-47"
                    .replace(/\d{6,}/g, '') // Remove long code numbers like "555088-134"
                    .replace(/\s+/g, ' ')
                    .trim();
            },
            
            // Build mapping from available images
            mapping: {},
            
            // Initialize mapping
            init: function() {
                availableImages.forEach(imgName => {
                    // Remove _1.jpg or _2.jpg to get base name
                    const baseName = imgName.replace(/_\d\.jpg$/, '');
                    // Store with _1.jpg (prefer first image)
                    this.mapping[baseName] = `imagens_produtos/${imgName}`;
                });
                console.log('‚úÖ Mapeamento de imagens inicializado:', Object.keys(this.mapping).length, 'imagens');
            },
            
            // Get image path for a product - STRICT MATCHING (only best match)
            getImage: function(productName) {
                // Normalize product name
                const normalizedProduct = this.normalize(productName);
                
                let bestMatch = null;
                let bestScore = 0;
                
                // Try to find the best matching image
                for (const [imgName, path] of Object.entries(this.mapping)) {
                    const normalizedImg = this.normalize(imgName);
                    let score = 0;
                    
                    // Exact match = highest score
                    if (normalizedImg === normalizedProduct) {
                        score = 100;
                    }
                    // Very close match (one contains the other and they're similar length)
                    else if ((normalizedProduct.includes(normalizedImg) || normalizedImg.includes(normalizedProduct)) && 
                             Math.abs(normalizedProduct.length - normalizedImg.length) < 10) {
                        // Calculate similarity based on common words
                        const productWords = normalizedProduct.split(/\s+/).filter(w => w.length > 2);
                        const imgWords = normalizedImg.split(/\s+/).filter(w => w.length > 2);
                        const commonWords = productWords.filter(w => imgWords.includes(w));
                        score = (commonWords.length / Math.max(productWords.length, imgWords.length)) * 80;
                    }
                    // Partial match with key words
                    else {
                        const productWords = normalizedProduct.split(/\s+/).filter(p => 
                            p.length > 3 && 
                            !['retro', 'air', 'jordan', 'jordans', 'nike', 'high', 'mid', 'low', 'og', 'gs', 'white', 'black', 'blue', 'red'].includes(p.toLowerCase())
                        );
                        const imgWords = normalizedImg.split(/\s+/).filter(p => 
                            p.length > 3 && 
                            !['retro', 'air', 'jordan', 'jordans', 'nike', 'high', 'mid', 'low', 'og', 'gs', 'white', 'black', 'blue', 'red'].includes(p.toLowerCase())
                        );
                        
                        if (productWords.length > 0 && imgWords.length > 0) {
                            const matches = productWords.filter(p => 
                                imgWords.some(ip => ip === p || (ip.includes(p) && p.length > 4) || (p.includes(ip) && ip.length > 4))
                            );
                            // Need at least 70% of key words to match
                            if (matches.length / productWords.length >= 0.7 && matches.length >= 2) {
                                score = (matches.length / Math.max(productWords.length, imgWords.length)) * 60;
                            }
                        }
                    }
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMatch = path;
                    }
                }
                
                // Only return if score is high enough (strict matching)
                return bestScore >= 70 ? bestMatch : null;
            },
            
            // Track which images are already assigned
            assignedImages: new Set(),
            
            // Get image with assignment tracking (ensures one image per product only)
            getImageWithTracking: function(productName) {
                const image = this.getImage(productName);
                if (image && !this.assignedImages.has(image)) {
                    this.assignedImages.add(image);
                    return image;
                }
                return null;
            }
        };

        // Initialize image mapping
        imageMap.init();

        // Get product image - products already have image assigned in filterProductsWithImages
        function getProductImage(product) {
            // First check if product has a local image assigned
            if (product.image) {
                return product.image;
            }
            
            // If no local image, try to get online image
            if (product.onlineImage) {
                return product.onlineImage;
            }
            
            // Try to generate online image URL based on product name
            const onlineImageUrl = getOnlineImageUrl(product);
            if (onlineImageUrl) {
                product.onlineImage = onlineImageUrl;
                return onlineImageUrl;
            }
            
            return null;
        }
        
        // Get online image URL for product (using Unsplash or similar service)
        function getOnlineImageUrl(product) {
            // Clean product name for search
            let searchTerm = formatProductName(product);
            // Remove common words
            searchTerm = searchTerm.replace(/\b(air|jordan|jordans|nike|retro|high|mid|low|og|gs)\b/gi, '').trim();
            // Take first 3-4 words
            const words = searchTerm.split(/\s+/).filter(w => w.length > 2).slice(0, 4);
            searchTerm = words.join(' ');
            
            if (!searchTerm) return null;
            
            // Use Unsplash API for sneaker images (free, no key required for basic usage)
            // Format: https://source.unsplash.com/featured/?sneakers,{searchTerm}
            // But Unsplash doesn't have specific product images, so we'll use a placeholder service
            
            // Alternative: Use a placeholder service that can search for images
            // For now, we'll use a generic sneaker image service
            // You can replace this with a real image search API
            
            // Using a placeholder approach - in production, you'd use a real image search API
            // For now, return null and let the placeholder show
            return null;
        }

        // Create placeholder HTML
        function createPlaceholderHTML() {
            return `
                <div class="flex flex-col items-center justify-center p-6 text-center h-full">
                    <div class="text-7xl mb-4 animate-pulse">üëü</div>
                    <div class="text-2xl mb-2 font-black text-red-500 uppercase">STREETMOOD</div>
                    <div class="text-gray-400 text-sm mb-2">Imagem em atualiza√ß√£o</div>
                    <div class="text-gray-500 text-xs max-w-xs">Em breve ter√°s acesso<br>√† visualiza√ß√£o completa deste modelo</div>
                </div>
            `;
        }

        // Format product name - remove codes and format size
        function formatProductName(product) {
            let name = product.name;
            // Remove product codes (like 555088-134, CD4487-100, etc.)
            name = name.replace(/\s+\d{6,}[-\s]?\d{0,6}/g, '');
            // Remove codes at the end (like "555088-134")
            name = name.replace(/\s+\d{6,}-\d{3,}/g, '');
            // Clean up multiple spaces
            name = name.replace(/\s+/g, ' ').trim();
            return name;
        }
        
        // Format size display
        function formatSize(size) {
            if (!size) return '';
            // Convert "36-40" to "tamanhos do 36 ao 40"
            const match = size.match(/(\d+)-(\d+)/);
            if (match) {
                return `tamanhos do ${match[1]} ao ${match[2]}`;
            }
            return size;
        }
        
        // Render product card
        function renderProductCard(product) {
            const image = getProductImage(product);
            // Todos os produtos est√£o dispon√≠veis no STREETMOOD - sem badges de tipo
            const badge = '';
            
            const hasImage = image !== null;
            const formattedName = formatProductName(product);
            const formattedSize = formatSize(product.size);
            
            let imageHTML = '';
            if (hasImage) {
                imageHTML = `<img src="${image}" 
                                  alt="${formattedName}" 
                                  class="product-image w-full h-full object-contain"
                                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                           <div class="hidden absolute inset-0 flex flex-col items-center justify-center p-4 text-center">
                               <div class="text-5xl mb-2 animate-pulse">üëü</div>
                               <div class="text-xs text-gray-400">Imagem em atualiza√ß√£o</div>
                           </div>`;
            } else {
                imageHTML = `<div class="flex flex-col items-center justify-center p-4 text-center h-full">
                                <div class="text-5xl mb-2 animate-pulse">üëü</div>
                                <div class="text-xs text-gray-400">Imagem em atualiza√ß√£o</div>
                            </div>`;
            }
            
            return `
                <div class="product-card glass-effect rounded-2xl p-4 cursor-pointer" 
                     onclick="openModal(${product.id})"
                     data-aos="fade-up"
                     data-name="${product.name.toLowerCase()}"
                     data-price="${product.price_eur}"
                     data-type="${product.tipo}">
                    <div class="relative mb-4 bg-gray-800 rounded-xl overflow-hidden h-48 flex items-center justify-center">
                        ${imageHTML}
                    </div>
                    <div class="space-y-2">
                        <h3 class="font-bold text-sm uppercase leading-tight line-clamp-2">${formattedName}</h3>
                        ${formattedSize ? `<p class="text-gray-400 text-xs">${formattedSize}</p>` : ''}
                        <div class="flex justify-between items-center">
                            <p class="text-red-500 font-black text-lg">${product.price_eur}‚Ç¨</p>
                        </div>
                        <button class="w-full mt-2 py-2 glass-effect rounded-lg text-sm font-semibold hover:bg-white/10 transition-colors">
                            Ver mais
                        </button>
                    </div>
                </div>
            `;
        }

        // Render products grid with pagination
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            if (currentProducts.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-400">Nenhum produto encontrado.</div>';
                renderPagination();
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(currentProducts.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsToShow = currentProducts.slice(startIndex, endIndex);
            
            grid.innerHTML = productsToShow.map(renderProductCard).join('');
            AOS.refresh();
            
            // Render pagination
            renderPagination(totalPages);
        }

        // Render pagination buttons
        function renderPagination(totalPages = 1) {
            const paginationDiv = document.getElementById('pagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button onclick="goToPage(${currentPage - 1})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                        ‚Üê Anterior
                    </button>
                `;
            }
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                paginationHTML += `<button onclick="goToPage(1)" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2 text-gray-500">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === currentPage) {
                    paginationHTML += `
                        <button class="btn-primary px-4 py-2 rounded-lg font-semibold">
                            ${i}
                        </button>
                    `;
                } else {
                    paginationHTML += `
                        <button onclick="goToPage(${i})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                            ${i}
                        </button>
                    `;
                }
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2 text-gray-500">...</span>`;
                }
                paginationHTML += `<button onclick="goToPage(${totalPages})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">${totalPages}</button>`;
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button onclick="goToPage(${currentPage + 1})" class="glass-effect px-4 py-2 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                        Pr√≥xima ‚Üí
                    </button>
                `;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }

        // Go to specific page
        function goToPage(page) {
            currentPage = page;
            renderProducts();
            // Scroll to top of products grid
            document.getElementById('productsGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Filter products - Todos os produtos est√£o dispon√≠veis no STREETMOOD
        function filterProducts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sort = document.getElementById('sortSelect').value;
            
            let filtered = window.products || [];
            
            // Search filter
            if (search) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(search) ||
                    (p.size && p.size.toLowerCase().includes(search))
                );
            }
            
            // Sort - produtos com imagens primeiro
            filtered.sort((a, b) => {
                // Se for "todos", produtos com imagem primeiro, depois aplicar ordena√ß√£o
                if (sort === 'all') {
                    const aHasImage = a.image ? 1 : 0;
                    const bHasImage = b.image ? 1 : 0;
                    if (aHasImage !== bHasImage) {
                        return bHasImage - aHasImage; // Com imagem primeiro
                    }
                    // Depois ordenar por ID (mais recente primeiro)
                    return (b.id || 0) - (a.id || 0);
                }
                
                // Primeiro: produtos com imagem aparecem antes dos sem imagem (exceto para "todos")
                const aHasImage = a.image ? 1 : 0;
                const bHasImage = b.image ? 1 : 0;
                if (aHasImage !== bHasImage) {
                    return bHasImage - aHasImage; // Com imagem primeiro
                }
                
                // Depois: aplicar ordena√ß√£o selecionada
                if (sort === 'price-asc') {
                    return (a.price_eur || 0) - (b.price_eur || 0);
                } else if (sort === 'price-desc') {
                    return (b.price_eur || 0) - (a.price_eur || 0);
                } else if (sort === 'name') {
                    return (a.name || '').localeCompare(b.name || '');
                } else {
                    // Mais recentes (por ID, maior ID = mais recente)
                    return (b.id || 0) - (a.id || 0);
                }
            });
            
            currentProducts = filtered;
            currentPage = 1; // Reset to first page when filtering
            renderProducts();
        }

        // Switch tab
        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                btn.classList.add('text-gray-400');
            });
            const activeBtn = document.querySelector(`[data-tab="${tab}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'text-white');
                activeBtn.classList.remove('text-gray-400');
            }
            filterProducts();
        }

        // Open modal
        function openModal(productId) {
            const products = window.products || [];
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentProduct = product;
            const modal = document.getElementById('productModal');
            const image = getProductImage(product);
            
            // Format product name and size for modal
            const formattedName = formatProductName(product);
            const formattedSize = formatSize(product.size);
            const modalTitle = formattedName + (formattedSize ? `, ${formattedSize}` : '');
            
            // Set modal content
            document.getElementById('modalTitle').textContent = modalTitle;
            document.getElementById('modalPrice').textContent = `${product.price_eur}‚Ç¨`;
            document.getElementById('modalTag').textContent = 'Dispon√≠vel no STREETMOOD';
            document.getElementById('modalDescription').textContent = product.desc || 
                `Produto premium importado. Envio gr√°tis. Caixa STREETMOOD inclu√≠da. Caixa original dispon√≠vel (+5‚Ç¨).`;
            
            // Todos os produtos est√£o dispon√≠veis - sem badge de tipo
            document.getElementById('modalBadge').innerHTML = '';
            
            // Set viewer with placeholder if no image
            const viewer = document.getElementById('modalViewer');
            viewer.innerHTML = '';
            
            // Check if image exists or use placeholder
            if (image) {
                const img = new Image();
                img.onload = function() {
                    viewer.innerHTML = `
                        <img src="${image}" 
                             alt="${formattedName}" 
                             class="max-w-full max-h-full object-contain rounded-xl">
                    `;
                };
                img.onerror = function() {
                    viewer.innerHTML = createPlaceholderHTML();
                };
                img.src = image;
            } else {
                viewer.innerHTML = createPlaceholderHTML();
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('productModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';
        }

        // Contact seller (Buy/DM button)
        function contactSeller() {
            if (!currentProduct) return;
            
            const name = currentProduct.name;
            const size = currentProduct.size || '';
            const msg = encodeURIComponent(`Ol√° STREETMOOD üëü quero comprar o ${name}${size ? ' (T:' + size + ')' : ''} ainda est√° dispon√≠vel?`);
            window.open(`https://wa.me/351929461628?text=${msg}`, '_blank');
        }

        // Reserve product
        function reserveProduct() {
            if (!currentProduct) return;
            
            const name = currentProduct.name;
            const msg = encodeURIComponent(`Ol√° STREETMOOD üëü quero reservar o ${name}. Podes enviar fotos reais antes do envio?`);
            window.open(`https://wa.me/351929461628?text=${msg}`, '_blank');
        }

        // Open WhatsApp (header button)
        function openWhatsApp() {
            const msg = encodeURIComponent('Ol√° STREETMOOD! Quero saber mais sobre os vossos produtos.');
            window.open(`https://wa.me/351929461628?text=${msg}`, '_blank');
        }

        // Close modal on ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Assign images to products (one image per product, best match only)
        function assignImagesToProducts() {
            if (!window.products || window.products.length === 0) {
                return;
            }
            
            // Reset assigned images for fresh matching
            imageMap.assignedImages.clear();
            
            // Create array to store products with their match scores
            const productsWithScores = window.products.map(product => {
                // Try to find matching image
                const normalizedProduct = imageMap.normalize(product.name);
                let bestImage = null;
                let bestScore = 0;
                
                // Check all available images
                for (const [imgName, path] of Object.entries(imageMap.mapping)) {
                    const normalizedImg = imageMap.normalize(imgName);
                    let score = 0;
                    
                    // Exact match = highest score
                    if (normalizedImg === normalizedProduct) {
                        score = 100;
                    }
                    // Very close match (one contains the other and they're similar length)
                    else if ((normalizedProduct.includes(normalizedImg) || normalizedImg.includes(normalizedProduct)) && 
                             Math.abs(normalizedProduct.length - normalizedImg.length) < 10) {
                        const productWords = normalizedProduct.split(/\s+/).filter(w => w.length > 2);
                        const imgWords = normalizedImg.split(/\s+/).filter(w => w.length > 2);
                        const commonWords = productWords.filter(w => imgWords.includes(w));
                        score = (commonWords.length / Math.max(productWords.length, imgWords.length)) * 80;
                    }
                    // Partial match with key words
                    else {
                        const productWords = normalizedProduct.split(/\s+/).filter(p => 
                            p.length > 3 && 
                            !['retro', 'air', 'jordan', 'jordans', 'nike', 'high', 'mid', 'low', 'og', 'gs', 'white', 'black', 'blue', 'red'].includes(p.toLowerCase())
                        );
                        const imgWords = normalizedImg.split(/\s+/).filter(p => 
                            p.length > 3 && 
                            !['retro', 'air', 'jordan', 'jordans', 'nike', 'high', 'mid', 'low', 'og', 'gs', 'white', 'black', 'blue', 'red'].includes(p.toLowerCase())
                        );
                        
                        if (productWords.length > 0 && imgWords.length > 0) {
                            const matches = productWords.filter(p => 
                                imgWords.some(ip => ip === p || (ip.includes(p) && p.length > 4) || (p.includes(ip) && ip.length > 4))
                            );
                            // Need at least 70% of key words to match
                            if (matches.length / productWords.length >= 0.7 && matches.length >= 2) {
                                score = (matches.length / Math.max(productWords.length, imgWords.length)) * 60;
                            }
                        }
                    }
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestImage = path;
                    }
                }
                
                return { product, image: bestImage, score: bestScore };
            });
            
            // Sort by score (highest first) - best matches get images first
            productsWithScores.sort((a, b) => b.score - a.score);
            
            // Assign images to products (one image per product, best match first)
            const usedImages = new Set();
            
            for (const { product, image, score } of productsWithScores) {
                if (image && score >= 70 && !usedImages.has(image)) {
                    usedImages.add(image);
                    // Add image property to product
                    product.image = image;
                } else {
                    // Product without image match
                    product.image = null;
                }
            }
            
            const productsWithImages = window.products.filter(p => p.image !== null).length;
            console.log(`‚úÖ ${productsWithImages} produtos com imagens correspondentes de ${window.products.length} totais`);
        }

        // Initialize
        async function init() {
            // Wait a bit to ensure products are loaded
            if (!window.products || window.products.length === 0) {
                console.warn('‚ö†Ô∏è Aguardando carregamento de produtos...');
                let attempts = 0;
                while ((!window.products || window.products.length === 0) && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
            }
            
            if (window.products && window.products.length > 0) {
                console.log('‚úÖ Produtos carregados:', window.products.length);
                // Assign images to products (one image per product, best match only)
                assignImagesToProducts();
                // Sort products: with images first, then by ID (most recent first)
                window.products.sort((a, b) => {
                    // Primeiro: produtos com imagem aparecem antes dos sem imagem
                    const aHasImage = a.image ? 1 : 0;
                    const bHasImage = b.image ? 1 : 0;
                    if (aHasImage !== bHasImage) {
                        return bHasImage - aHasImage; // Com imagem primeiro
                    }
                    // Depois: ordenar por ID (mais recente primeiro)
                    return (b.id || 0) - (a.id || 0);
                });
                // Show all products (with or without images)
                currentProducts = window.products;
                currentPage = 1;
                renderProducts();
            } else {
                console.error('‚ùå Nenhum produto foi carregado!');
                document.getElementById('productsGrid').innerHTML = '<div class="col-span-full text-center py-12 text-gray-400">Erro ao carregar produtos. Por favor, recarrega a p√°gina.</div>';
            }
        }

        // Start initialization
        init();
    </script>
</body>
</html>
